---
title: "Untitled"
author: "Renata Diaz"
date: "12/4/2018"
output: html_document
---



* Saved the first three axes for both PCoAs.
* Use these six axes, and year, as predictor values for RDA.


## Partial RDA

Partial redundancy analysis, using combined winter and summer axes, conditioned on year, to predict the rodent community.
 
Restricted to years with both a winter & summer census (n = 27).

Used rodent data, summarized yearly, transformed via Hellinger transformation.

``` {r partial RDA, echo = T}

rodents <- read.csv('data/rodents-adjusted.csv', 
                    stringsAsFactors = F)

summer_axes <- read.csv('models/Summer_pcoa_vals_3.csv', 
                        stringsAsFactors = F)

winter_axes <- read.csv('models/Winter_pcoa_vals_3.csv',
                        stringsAsFactors = F)


pred_vals <- inner_join(winter_axes, summer_axes, by = 'year')

rodents <- filter(rodents, year %in% pred_vals$year) %>%
  select(-year)

pred_vals_noy <- select(pred_vals, -year)
pred_vals_y <- select(pred_vals, year)

rodents_hel <- decostand(rodents, 'hellinger')

rodents_prda <- rda(rodents_hel ~ . + Condition(pred_vals_y$year), pred_vals_noy)

R2 <- RsquareAdj(rodents_prda)$r.squared
R2adj <- RsquareAdj(rodents_prda)$adj.r.squared

R2
R2adj


anova(rodents_prda, step = 1000)
anova(rodents_prda, by = "axis", step = 1000)


```

Find the most parsimonious model...

```{r reduce vars part, echo = T}

set.seed(11)
step.forward <- ordiR2step(rda(rodents_hel ~ 1, data = pred_vals), scope = formula(rodents_prda), 
                           R2scope = F, direction = "forward", pstep = 1000)

# Most parsimonious is Call: rodents_hel ~ WinterPCoAxis_1 + WinterPCoAxis_3 + WinterPCoAxis_2 

rod_prda_pars <- rda(rodents_hel ~ WinterPCoAxis_1 + WinterPCoAxis_3 + WinterPCoAxis_2 + Condition(pred_vals_y$year), pred_vals_noy)

pR2p <- RsquareAdj(rod_prda_pars)$r.squared
pR2adjp <- RsquareAdj(rod_prda_pars)$adj.r.squared

pR2p
pR2adjp


anova(rod_prda_pars, step = 1000)
anova(rod_prda_pars, by = "axis", step = 1000)


```


## Regular RDA

```{r regular rda, echo = T}
rodents_rda <- rda(rodents_hel ~ ., pred_vals)

R2 <- RsquareAdj(rodents_rda)$r.squared
R2adj <- RsquareAdj(rodents_rda)$adj.r.squared

R2
R2adj


anova(rodents_rda, step = 1000)
anova(rodents_rda, by = "axis", step = 1000)
```
Find the most parsimonious model...

```{r reduce vars regular, echo = T}

set.seed(11)
step.forward <- ordiR2step(rda(rodents_hel ~ 1, data = pred_vals), scope = formula(rodents_rda), 
                           R2scope = F, direction = "forward", pstep = 1000)

# Most parsimonious is rodents_hel ~ WinterPCoAxis_1 + WinterPCoAxis_3 + WinterPCoAxis_2 +  SummerPCoAxis_2 

rod_rda_pars <- rda(rodents_hel ~ WinterPCoAxis_1 + WinterPCoAxis_3 + WinterPCoAxis_2 + SummerPCoAxis_2, pred_vals)

R2p <- RsquareAdj(rod_rda_pars)$r.squared
R2adjp <- RsquareAdj(rod_rda_pars)$adj.r.squared

R2p
R2adjp


anova(rod_rda_pars, step = 1000)
anova(rod_rda_pars, by = "axis", step = 1000)


```
## Variance partitioning

```{r  partial variance partitioning, echo = T}

rod_ppart <- varpart(rodents_hel, ~ WinterPCoAxis_1, ~ WinterPCoAxis_3, ~  WinterPCoAxis_2, ~ pred_vals_y$year, data = pred_vals_noy)
rod_ppart

plot(rod_ppart, digits = 2)
```

WinterPCoAxis_1 combined with year has the largest chunk (.34); on its own, WinterPCoAxis_1 explains an additional .1

```{r  regular variance partitioning, echo = T}

rod_part <- varpart(rodents_hel, ~ WinterPCoAxis_1, ~ WinterPCoAxis_3, ~  WinterPCoAxis_2, ~ SummerPCoAxis_2, data = pred_vals)
rod_part

plot(rod_part, digits = 2)
```

How strongly is summer axis 2 related to year?

```{r plot summer pcoa2 v year}
plot(pred_vals$year, pred_vals$SummerPCoAxis_2)
```

### Years - rodents comparison

```{r plot winter pcoa1 v year}
 

plot(pred_vals$year, pred_vals$WinterPCoAxis_1)
abline(v = 1990, col = 'red')

colnames(rodents)

rodents_props <- rodents/rowSums(rodents)


plot(pred_vals$year, rodents_props$DS, col = 'blue')
points(pred_vals$year, rodents_props$PE, col = 'green')
points(pred_vals$year, rodents_props$RM, col = 'purple')
points(pred_vals$year, rodents_props$DM, col = 'pink')
abline(v = 1990, col = 'red')




```


### Partial RDA on just species of interest

Since the first round of RDA seems to be very much about DS, can I just look at the species whose dynamics in the 1990s are of interest? RM, PE, and DM?

``` {r prda focal spp}

focal_species <- rodents_hel %>%
  select(RM, PE, DM)

frodents_prda <- rda(focal_species ~ . + Condition(pred_vals_y$year), pred_vals_noy)

R2 <- RsquareAdj(frodents_prda)$r.squared
R2adj <- RsquareAdj(frodents_prda)$adj.r.squared

R2
R2adj


anova(rodents_prda, step = 1000)
anova(rodents_prda, by = "axis", step = 1000)
set.seed(11)
step.forward <- ordiR2step(rda(focal_species ~ 1, data = pred_vals), scope = formula(frodents_prda), 
                           R2scope = F, direction = "forward", pstep = 1000)

# ## Call: focal_species ~ WinterPCoAxis_1 + SummerPCoAxis_2 

frod_prda_pars <- rda(focal_species ~ WinterPCoAxis_1 + SummerPCoAxis_2 + Condition(pred_vals_y$year), pred_vals_noy)

fpR2p <- RsquareAdj(frod_prda_pars)$r.squared
fpR2adjp <- RsquareAdj(frod_prda_pars)$adj.r.squared

fpR2p
fpR2adjp


anova(frod_prda_pars, step = 1000)
anova(frod_prda_pars, by = "axis", step = 1000)

frod_part <- varpart(focal_species, ~ WinterPCoAxis_1,  ~ SummerPCoAxis_2, ~year, data = pred_vals)
plot(frod_part, digits = 2)

```

Again, WinterPCoAxis_1 is the most important and explains the most variation (although less). 

So, I think WinterPCoAxis_1 is important to the rodent community. 

